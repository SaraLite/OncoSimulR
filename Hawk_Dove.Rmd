---
title: "Hawk and Dove"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown



```{r}
suppressPackageStartupMessages(library("OncoSimulR"))
suppressPackageStartupMessages(library("ggplot2"))

options(stringsAsFactors = FALSE)

simul_boxplot2 <- function(df) {
  e <- ggplot(df, aes(x = Genotype, y = N))
  e + geom_boxplot(aes(fill = Genotype)) +
    stat_summary(fun.y = mean, geom = "point",
                 shape = 18, size = 2.5, color = "#FC4E07") 
}

compositionPop2 <- function(objPop) {
  clon_labels <- c("WT", objPop[[1]]$geneNames)
  listPop <- sapply(objPop, function(x) tail(x[[1]], 1)[1, -1])
  dfPop <- data.frame("Genotype" = rep(clon_labels, length(listPop)/length(clon_labels)),
                      "N" = c(listPop))
  print(dfPop)
  simul_boxplot2(dfPop)
}

```

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

Evolutionary games theory

In mathematics, particularly in calculus, a stationary point of a differentiable function of one variable is a point on the graph of the function where the function's derivative is zero.Informally, it is a point where the function "stops" increasing or decreasing. 

The example we are going to show is one of the first games that Maynar Smith analyzed, the classic game: Hawk and Dove (https://en.wikipedia.org/wiki/Chicken_(game))

In this game, the two competitors are subtypes of the same species but with different strategies.  The Hawk first displays aggression, then escalates into a fight until it either wins or is injured (loses). The Dove first displays aggression, but if faced with major escalation runs for safety. If not faced with such escalation, the Dove attempts to share the resource.

![Payoff Matrix for Hawk Dove Game](OncoSimulR_Ejercicio2\Images_markdown\Hawk_Dove_payoff.PNG)

Given that the resource is given the value V, the damage from losing a fight is given cost C:[1]

- If a Hawk meets a Dove he gets the full resource V to himself
- If a Hawk meets a Hawk – half the time he wins, half the time he loses...so his average outcome is then V/2 minus C/2
- If a Dove meets a Hawk he will back off and get nothing – 0
- If a Dove meets a Dove both share the resource and get V/2

The actual payoff however depends on the probability of meeting a Hawk or Dove, which in turn is a representation of the percentage of Hawks and Doves in the population when a particular contest takes place. That in turn is determined by the results of all of the previous contests. If the cost of losing C is greater than the value of winning V (the normal situation in the natural world) the mathematics ends in an stationary point (ESS), a mix of the two strategies where the population of Hawks is V/C.

In this case we assume a stable equilibrium in the population dynamics, that is, although there are external variations in the model, it recovers and returns to equilibrium (as shown in the image below).

![Stable equilibrium](OncoSimulR_Ejercicio2\Images_markdown\Stable_equilibrium.jpg)

We are going to simulate with OncoSimulR the situation in which the cost of losing C is greater than the value of gaining V (C = 10, V = 2). 

```{r}
## Stablish Genotype-Fitnees mapping
H_D_fitness <- function(c, v,
                    gt = c("WT", "H", "D")) {
  data.frame(Genotype = gt,
             Fitness = c(
               paste0("1"),
               paste0("1 + f_1 *", (v-c)/2, "+ f_2 *", v),
               paste0("1 + f_2 *", v/2)))
}

## Fitness Effects specification
HD_competition <-allFitnessEffects(
  genotFitness = H_D_fitness(10, 2, 
                         gt = c("WT", "H", "D")),
  frequencyDependentFitness = TRUE,
  frequencyType = "rel",
  spPopSizes = c(5000, 5000, 5000))

## Plot fitness landscape of genotype "H, D" evaluation
D <- evalGenotype(genotype = "D", fitnessEffects = HD_competition, echo = TRUE)
H <- evalGenotype(genotype = "H", fitnessEffects = HD_competition, echo = TRUE) 

# plotFitnessLandscape(evalAllGenotypes(fitnessEffects = HD_competition))

options(stringsAsFactors = FALSE)
simulation <- oncoSimulPop(20,
                           mc.cores = 6,
                           HD_competition,
                           model = "McFL", # There is no collapse
                           onlyCancer = FALSE,
                           finalTime = 500,
                           mu = 1e-2,
                           initSize = 4000,
                           keepPhylog = TRUE,
                           seed = NULL,
                           errorHitMaxTries = FALSE,
                           errorHitWallTime = FALSE)

plot(simulation[[1]], show = "genotypes", type = "line", xlim = c(40, 500))
compositionPop2(simulation)

```


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
