# Game Theory with social dilemmas of tumour acidity and vasculature

This example is based on the paper _Cancer treatment scheduling and dynamic heterogeneity in social dilemmas of tumour acidity and vasculature_ (**referencia**) available at <https://doi.org/10.1038/bjc.2017.5>. In this work, it is explained that the progression of cancer is marked by the acquisition of a number of hallmarks, including self-sufficiency of growth factor production for angiogenesis and reprogramming energy metabolism for aerobic glycolysis. Moreover, there is evidence of intra-tumour heterogeneity. Given that some cancer cells can not invest in something that benefits the whole tumor while others can free-ride on the benefits created by them (evolutionary social dilemmas), how do these population level traits evolve, and how are they maintained? The authors answer this question with a mathematical model that treats acid production through glycolysis as a tumour-wide public good that is coupled to the club good of oxygen from better vascularisation.

```{r message = FALSE, warning = FALSE}

library(OncoSimulR)
library(ggplot2)
options(stringsAsFactors = FALSE) ## get rid of the messages

simul_boxplot2 <- function(df) {
  e <- ggplot(df, aes(x = Genotype, y = N))
  e + geom_boxplot(aes(fill = Genotype)) +
    stat_summary(fun.y = mean, geom = "point",
                 shape = 18, size = 2.5, color = "#FC4E07") 
}

compositionPop2 <- function(objPop) {
  clon_labels <- c("WT", objPop[[1]]$geneNames)
  listPop <- sapply(objPop, function(x) tail(x[[1]], 1)[1, -1])
  dfPop <- data.frame("Genotype" = rep(clon_labels, length(listPop)/length(clon_labels)),
                      "N" = c(listPop))
  simul_boxplot2(dfPop)
}

```

The cell types of the model are:

* VOP: VEGF (over)-producers.
* GLY: glycolytic cells.
* DEF: aerobic cells that do not call for more vasculature.

On the other hand, the micro-environmental parameters of the model are:

* a: the benefit per unit of acidification.
* v: the benefit from oxygen per unit of vascularisation.
* c: the cost of (over)-producing VEGF.

The fitness equations derived from those populations and parameters are:

<br>
\begin{equation}
  W\left(GLY\right) = 1 + a * (f_1 + 1)
  (\#eq:fitnessGLY)
\end{equation}
<br>
\begin{equation}
  W\left(VOP\right) = 1 + a * f_1 + v * (f_2 + 1) - c
  (\#eq:fitnessVOP)
\end{equation}
<br>
\begin{equation}
  W\left(DEF\right) = 1 + a * f_1 + v * f_2
  (\#eq:fitnessDEF)
\end{equation}
<br>

Finally, depending of the parameter's values, the presented model can lead to three different situations:

##1. Fully glycolytic tumours: 

If the fitness benefit of a single unit of acidification is higher than the maximum benefit from the club good for aerobic cells, then GLY cells will always have a strictly higher fitness than aerobic cells, and be selected for. In this scenario, the population will converge towards all GLY, regardless of the initial proportions (as long as there is at least some GLY in the population).

```{r, message=FALSE}

# Definition of the function for creating the corresponding dataframe.
avc <- function (a, v, c) {
  data.frame(Genotype = c("WT", "GLY", "VOP", "DEF"),
             Fitness = c("1",
                         paste0("1 + ", a, " * (f_1 + 1)"),
                         paste0("1 + ", a, " * f_1 + ", v, " * (f_2 + 1) - ", c),
                         paste0("1 + ", a, " * f_1 + ", v, " * f_2")
                         ))
                          }

# Specification of the different effects on fitness.
afavc <- allFitnessEffects(genotFitness = avc(2.5, 2, 1),
                           frequencyDependentFitness = TRUE,
                           frequencyType = "rel")

# Launching of the simulation (20 times).
simulation <- oncoSimulPop(20,
                           mc.cores = 6,
                           afavc,
                           model = "McFL",
                           onlyCancer = FALSE,
                           finalTime = 25,
                           mu = 1e-2,
                           initSize = 4000,
                           keepPhylog = TRUE,
                           seed = NULL,
                           errorHitMaxTries = FALSE,
                           errorHitWallTime = FALSE)

# Representation of the plot of one simulation as an example (the others are highly similar), and a boxplot considering all of them.
plot(simulation[[1]], show = "genotypes", type = "line")
compositionPop2(simulation)

```

##2. Fully angiogenic tumours: 

If the benefit to VOP from their extra unit of vascularisation is higher than the cost c to produce that unit, then VOP will always have a strictly higher fitness than DEF, selecting the proportion of VOP cells towards 1. In addition, if the maximum possible benefit of the club good to aerobic cells is higher than the benefit of an extra unit of acidification, then for sufficiently high number of VOP, GLY will have lower fitness than aerobic cells. When both conditions are satisfied, the population will converge towards all VOP. 

```{r, message=FALSE}

# Definition of the function for creating the corresponding dataframe.
avc <- function (a, v, c) {
  data.frame(Genotype = c("WT", "GLY", "VOP", "DEF"),
             Fitness = c("1",
                         paste0("1 + ", a, " * (f_1 + 1)"),
                         paste0("1 + ", a, " * f_1 + ", v, " * (f_2 + 1) - ", c),
                         paste0("1 + ", a, " * f_1 + ", v, " * f_2")
                         ))
                          }

# Specification of the different effects on fitness.
afavc <- allFitnessEffects(genotFitness = avc(2.5, 7, 1), # Parametros de la interaccion
                           frequencyDependentFitness = TRUE,
                           frequencyType = "rel")

# Launching of the simulation (20 times).
simulation <- oncoSimulPop(20,
                           mc.cores = 6,
                           afavc,
                           model = "McFL",
                           onlyCancer = FALSE,
                           finalTime = 25,
                           mu = 1e-2,
                           initSize = 4000,
                           keepPhylog = TRUE,
                           seed = NULL,
                           errorHitMaxTries = FALSE,
                           errorHitWallTime = FALSE)

# Representation of the plot of one simulation as an example (the others are highly similar), and a boxplot considering all of them.
plot(simulation[[1]], show = "genotypes", type = "line")
compositionPop2(simulation)

```

##3. Heterogeneous tumours:

If the benefit from an extra unit of vascularisation in a fully aerobic group is lower than the cost c to produce that unit, then for a sufficiently low proportion of GLY and thus sufficiently large number of aerobic cells sharing the club good, DEF will have higher fitness than VOP. This will lead to a decrease in the proportion of VOP among aerobic cells and thus a decrease in the average fitness of aerobic cells. A lower fitness in aerobic cells will lead to an increase in the proportion of GLY until the aerobic groups (among which the club good is split) get sufficiently small and fitness starts to favour VOP over DEF, swinging the dynamics back.

```{r, message=FALSE}

# Definition of the function for creating the corresponding dataframe.
avc <- function (a, v, c) {
  data.frame(Genotype = c("WT", "GLY", "VOP", "DEF"),
             Fitness = c("1",
                         paste0("1 + ", a, " * (f_1 + 1)"),
                         paste0("1 + ", a, " * f_1 + ", v, " * (f_2 + 1) - ", c),
                         paste0("1 + ", a, " * f_1 + ", v, " * f_2")
                         ))
                          }

# Specification of the different effects on fitness.
afavc <- allFitnessEffects(genotFitness = avc(7.5, 2, 1), # Parametros de la interaccion
                           frequencyDependentFitness = TRUE,
                           frequencyType = "rel")

# Launching of the simulation (20 times).
simulation <- oncoSimulPop(20,
                           mc.cores = 6,
                           afavc,
                           model = "McFL",
                           onlyCancer = FALSE,
                           finalTime = 25,
                           mu = 1e-2,
                           initSize = 4000,
                           keepPhylog = TRUE,
                           seed = NULL,
                           errorHitMaxTries = FALSE,
                           errorHitWallTime = FALSE)

# Representation of the plot of one simulation as an example (the others are highly similar), and a boxplot considering all of them.
plot(simulation[[1]], show = "genotypes", type = "line")
compositionPop2(simulation)

```
